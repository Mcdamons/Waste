<script>
    const names=["1.‡∏ô‡∏≤‡∏á‡∏™‡∏∏‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏à‡∏≤‡∏£‡∏∏‡∏ß‡∏±‡∏í‡∏ô‡∏≤","2.‡∏ô‡∏≤‡∏¢‡∏ä‡∏π‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏≠‡∏≤‡∏à‡∏™‡∏π‡∏á‡πÄ‡∏ô‡∏¥‡∏ô","3.‡∏ô‡∏≤‡∏á‡∏à‡∏∏‡∏ë‡∏≤‡∏°‡∏≤‡∏® ‡∏õ‡∏£‡∏∞‡∏†‡∏≤‡∏û‡∏£‡∏£‡∏ì‡∏û‡∏á‡∏®‡πå","4.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏£‡∏±‡∏á‡∏©‡∏¥‡∏¢‡∏≤ ‡∏Ñ‡∏ï‡∏¥‡∏Å‡∏≤‡∏£","5. ‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏®‡∏¥‡∏Å‡∏≤‡∏ô‡∏ï‡πå ‡∏ß‡∏∏‡∏í‡∏¥‡∏Å‡∏≤‡∏ô‡∏ï‡πå‡∏ô‡∏ô‡∏ó‡πå","6.‡∏ô‡∏≤‡∏¢‡∏≠‡∏á‡∏≠‡∏≤‡∏à ‡∏ö‡∏∏‡∏ç‡∏ö‡∏£‡∏£‡∏•‡∏∏","7.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏û‡∏¥‡∏ä‡∏∏‡∏ï‡∏≤ ‡∏™‡∏≤‡∏°‡∏ô‡∏à‡∏¥‡∏ï‡∏ï‡∏¥","8.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏•‡∏†‡∏±‡∏™ ‡∏Ç‡∏≤‡∏ß‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™","9.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Ç‡∏ô‡∏¥‡∏©‡∏ê‡∏≤ ‡πÄ‡∏≠‡∏µ‡πà‡∏¢‡∏°‡∏•‡∏∞‡∏≠‡∏≠","10.‡∏ô‡∏≤‡∏¢‡∏ò‡∏¥‡∏ï‡∏¥ ‡∏£‡∏∏‡∏à‡∏¥‡πÄ‡∏ä‡∏≤‡∏ß‡πå","11.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏û‡∏£‡∏£‡∏ì‡∏£‡∏≤‡∏¢ ‡∏™‡∏¥‡∏á‡∏´‡πå‡πÄ‡∏ñ‡∏∑‡πà‡∏≠‡∏ô","12.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ß‡∏£‡∏≤‡∏†‡∏£‡∏ì‡πå ‡∏†‡∏π‡∏ô‡∏≤‡πÄ‡∏´‡∏ô‡∏∑‡∏≠","13.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏â‡∏±‡∏ï‡∏£‡∏ä‡∏ô‡∏Å ‡∏ò‡∏±‡∏ä‡∏ä‡∏±‡∏¢‡∏°‡∏á‡∏Ñ‡∏•","14.‡∏ô‡∏≤‡∏¢‡∏ò‡∏ô‡∏ò‡∏£‡∏ì‡πå ‡∏î‡πâ‡∏ß‡∏á‡∏ó‡∏≠‡∏á","15.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÄ‡∏û‡∏ä‡∏£‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡∏´‡∏ß‡∏ô‡∏à‡∏¥‡∏ï‡∏£","16.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏£‡∏±‡∏ç‡∏ç‡∏≤ ‡∏ö‡∏∏‡∏ç‡∏°‡∏µ","17.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏à‡∏∏‡∏ë‡∏≤‡∏û‡∏£ ‡∏´‡∏á‡∏™‡πå‡∏ú‡∏≤‡∏ó‡∏≠‡∏á","18.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏£‡∏±‡∏ï‡∏ô‡∏≤‡∏†‡∏£‡∏ì‡πå ‡∏ä‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤","19.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏û‡∏£‡∏ò‡∏¥‡∏†‡∏≤ ‡∏ó‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏¢","20.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ß‡∏ô‡∏¥‡∏î‡∏≤ ‡∏ñ‡∏•‡∏∏‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á","21.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÄ‡∏Å‡∏©‡∏°‡∏™‡∏¥‡∏£‡∏¥ ‡πÇ‡∏Ü‡∏©‡∏∞‡∏ö‡∏î‡∏µ","22.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏ô‡∏±‡∏î‡∏î‡∏≤ ‡πÄ‡∏ï‡πâ‡∏≤‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥","23.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏≠‡∏£‡∏Å‡∏±‡∏ç‡∏ç‡∏≤ ‡∏ö‡∏∏‡∏ç‡∏°‡∏≤‡∏Å","24.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏≠‡∏ô‡∏∏‡∏™‡∏£‡∏≤ ‡∏ó‡∏≠‡∏á‡∏ö‡∏∏‡∏ç‡∏£‡∏±‡∏ï‡∏ô‡πå","25.‡∏ô‡∏≤‡∏¢‡πÄ‡∏•‡∏¥‡∏®‡∏£‡∏ö ‡∏ö‡∏∏‡∏ç‡∏•‡πâ‡∏≠‡∏°","26.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏à‡∏∏‡∏¨‡∏≤‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå ‡∏†‡∏±‡∏Å‡∏î‡∏µ","27.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏£‡∏µ‡∏õ‡∏£‡∏∞‡∏†‡∏≤ ‡∏£‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°","28.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏ô‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏£‡∏∑‡πà‡∏ô‡∏õ‡∏£‡∏≤‡∏ä‡∏ç‡πå","29.‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ö‡∏∏‡∏ç‡πÅ‡∏™‡∏á ‡πÄ‡∏ß‡∏î‡∏™‡∏±‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏∞","30.‡∏ô‡∏≤‡∏á‡πÅ‡∏û‡∏£‡∏™‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏á‡∏¥‡πâ‡∏ß‡∏£‡∏≤‡∏¢"];
    
    const works=["Assay ‡πÄ‡∏Ñ‡∏°‡∏µ","Assay ‡∏à‡∏∏‡∏•","‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏Ñ‡∏°‡∏µ","‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏à‡∏∏‡∏•","‡∏õ‡∏ô‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô","‡∏û‡∏±‡∏í‡∏ô‡∏≤","‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ú‡∏™‡∏°‡∏¢‡∏≤","‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£","‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ"];
    
    const wasteTypes=[
        {value:"Hydrocarbon",label:"Hydrocarbon",desc:"H ‡πÅ‡∏•‡∏∞ C ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Methanol, Acetone)"},
        {value:"Halogen",label:"Halogen",desc:"‡∏°‡∏µ‡∏ò‡∏≤‡∏ï‡∏∏ Cl, Br, I, F (NaCl, CH2Cl2)"},
        {value:"Inorganic",label:"Inorganic",desc:"Carbonate, Sulphate, Phosphate"},
        {value:"Heavy Metal",label:"Heavy Metal",desc:"‡∏°‡∏µ‡πÇ‡∏•‡∏´‡∏∞‡∏´‡∏ô‡∏±‡∏Å (FeSO4, PbCl2)"},
        {value:"High Toxic",label:"High Toxic",desc:"‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©‡∏™‡∏π‡∏á ‡∏Å‡πà‡∏≠‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á"},
        {value:"Acid",label:"Acid",desc:"pH ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 7"},
        {value:"Base",label:"Base",desc:"pH ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ 7"},
        {value:"Oxidizing",label:"Oxidizing",desc:"‡∏£‡∏±‡∏ö‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ï‡∏£‡∏≠‡∏ô (KMnO4, H2O2)"},
        {value:"Reducing",label:"Reducing",desc:"‡πÉ‡∏´‡πâ‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ï‡∏£‡∏≠‡∏ô (LiAlH4)"},
        {value:"Unknown",label:"Unknown",desc:"‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏ô‡∏¥‡∏î"},
        {value:"Solid",label:"Solid",desc:"‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡πÅ‡∏Ç‡πá‡∏á"}
    ];
    
    const storageLocations=["‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á waste ‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Ñ‡∏°‡∏µ / ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏ï‡∏™. 2","‡πÉ‡∏ï‡πâ‡∏ï‡∏π‡πâ‡∏î‡∏π‡∏î‡∏Ñ‡∏ß‡∏±‡∏ô","‡πÉ‡∏ï‡πâ‡πÇ‡∏ï‡πä‡∏∞‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° lab"];
    
    let currentStep=1;
    const totalSteps=9;
    const formData={};

    document.addEventListener('DOMContentLoaded',()=>{
        renderOptions('nameOptions',names);
        renderOptions('workOptions',works);
        renderWasteTypeOptions();
        renderOptions('storageOptions',storageLocations);
        populateVolumeSelect();
        document.getElementById('nextBtn').addEventListener('click',handleNext);
        document.getElementById('prevBtn').addEventListener('click',handlePrev);
        document.getElementById('experimentSelect').addEventListener('change',e=>{
            document.getElementById('experimentOther').style.display=e.target.value==='‡∏≠‡∏∑‡πà‡∏ô‡πÜ'?'block':'none';
        });
    });

    function renderOptions(id,opts){
        document.getElementById(id).innerHTML=opts.map(o=>`<div class="option" onclick="selectOption(this,'${id}','${o.replace(/'/g,"\\'")}')"><div class="option-radio"></div><span>${o}</span></div>`).join('');
    }

    function renderWasteTypeOptions(){
        document.getElementById('wasteTypeOptions').innerHTML=wasteTypes.map(t=>`<div class="option" onclick="selectOption(this,'wasteTypeOptions','${t.value}')"><div style="display:flex;gap:12px;width:100%;align-items:flex-start;"><div class="option-radio" style="margin-top:2px;"></div><div style="flex:1;"><div style="font-weight:600;">${t.label}</div><div style="font-size:14px;color:#6b7280;margin-top:4px;">${t.desc}</div></div></div></div>`).join('');
    }

    function populateVolumeSelect(){
        const s=document.getElementById('volumeSelect');
        for(let i=100;i<=4000;i+=100){
            const o=document.createElement('option');
            o.value=o.textContent=`${i} mL`;
            s.appendChild(o);
        }
        const b=document.createElement('option');
        b.value=b.textContent='‡∏ñ‡∏±‡∏á 20 L';
        s.appendChild(b);
    }

    function selectOption(el,id,val){
        document.getElementById(id).querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));
        el.classList.add('selected');
        const map={'nameOptions':'name','workOptions':'work','wasteTypeOptions':'wasteType','storageOptions':'storage'};
        formData[map[id]]=val;
    }

    function validateCurrentStep(){
        switch(currentStep){
            case 1:return!!formData.name;
            case 2:return!!formData.work;
            case 3:return!!formData.wasteType;
            case 4:
                const exp=document.getElementById('experimentSelect').value;
                if(!exp)return false;
                if(exp==='‡∏≠‡∏∑‡πà‡∏ô‡πÜ'){
                    const other=document.getElementById('experimentOther').value.trim();
                    if(other){formData.experiment=other;return true;}
                    return false;
                }
                formData.experiment=exp;
                return true;
            case 5:
                const chem=document.getElementById('chemicalName').value.trim();
                if(chem){formData.chemicalName=chem;return true;}
                return false;
            case 6:
                const vol=document.getElementById('volumeSelect').value;
                if(vol){formData.volume=vol;return true;}
                return false;
            case 7:
                formData.bottleId=document.getElementById('bottleId').value.trim();
                return true;
            case 8:return!!formData.storage;
            case 9:
                formData.suggestion=document.getElementById('suggestion').value.trim();
                return true;
            default:return false;
        }
    }

    function handleNext(){
        if(!validateCurrentStep()){alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');return;}
        if(currentStep<totalSteps){currentStep++;updateUI();}else{submitForm();}
    }

    function handlePrev(){
        if(currentStep>1){currentStep--;updateUI();}
    }

    function updateUI(){
        document.querySelectorAll('.question').forEach(q=>q.classList.remove('active'));
        document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
        const prog=(currentStep/totalSteps)*100;
        document.getElementById('progressBar').style.width=`${prog}%`;
        document.getElementById('progressText').textContent=`‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà ${currentStep} ‡∏à‡∏≤‡∏Å ${totalSteps}`;
        document.getElementById('prevBtn').style.display=currentStep>1?'block':'none';
        document.getElementById('nextBtn').textContent=currentStep===totalSteps?'‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• üéØ':'‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí';
    }

    async function submitForm(){
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á timestamp
        formData.timestamp = new Date().toLocaleString('th-TH', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });

        console.log('üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', formData);

        // ‡πÅ‡∏™‡∏î‡∏á loading
        const submitBtn = document.getElementById('nextBtn');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
        submitBtn.disabled = true;

        // Web App URL
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbztAGCSebxw7NnhEbgMos2oa7DXZZ0taC3s2so9_TOrFqEnNskZy6Bxt4yV2yz1Y1Du/exec';

        try {
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Apps Script
            const response = await fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });

            console.log('‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

            // ‡∏£‡∏≠ 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ Sheet
            await new Promise(resolve => setTimeout(resolve, 1000));

            // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('successScreen').classList.add('active');

        } catch (error) {
            console.error('‚ùå Error:', error);
            
            alert('‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:
1. ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï
2. Web App URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å:
' + JSON.stringify(formData, null, 2));
            
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    }
</script>
